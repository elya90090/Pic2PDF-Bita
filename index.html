<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pic2PDF Bita v1.6</title>
  <style>
    body { font-family: sans-serif; background:#eaf2f8; margin:0; padding:0; direction:rtl; }
    header { display:flex; align-items:center; justify-content:space-between; background:#3498db; color:#fff; padding:10px 20px; }
    header img { height:100px; max-width:200px; border-radius:10px; object-fit:contain; }
    header h1 { margin:0; font-size:1.8em; text-align:center; flex:1; }
    header span { font-size:1em; opacity:0.9; }
    .container { max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px #ccc; }
    .container label { display:block; margin-bottom:6px; } /* Ù„ÛŒØ¨Ù„ Ø±ÙˆÛŒ Ø®Ø· Ø®ÙˆØ¯Ø´ */
    input[type="file"], input[type="text"] { padding:5px; box-sizing:border-box; width:100%; }
    input[type="text"] { margin-bottom:15px; margin-top:4px; } /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù„ÛŒØ¨Ù„ */
    ul { list-style:none; padding:0; margin:10px 0; }
    li { margin:5px 0; padding:5px; background:#f0f0f0; display:flex; justify-content:space-between; align-items:center; border-radius:5px; }
    button { margin-left:5px; cursor:pointer; }
    .merge-order { margin:10px 0 16px; }
    .merge-order .option { display:block; margin:4px 0; }
    .download-btn { width:100%; padding:12px; background:#27ae60; color:#fff; border:none; border-radius:8px; cursor:pointer; font-size:1.1em; font-weight:bold; }
    .download-btn:hover { background:#1e8449; }

    /* Ù‡Ø± Ø±Ø¯ÛŒÙ Ø¢Ù¾Ù„ÙˆØ¯ Ø±ÙˆÛŒ Ø®Ø· Ø®ÙˆØ¯Ø´ */
    .file-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø¯Ùˆ Ø±Ø¯ÛŒÙ Ø¢Ù¾Ù„ÙˆØ¯ */
    }
    .file-row label { 
      white-space: nowrap; /* Ù…ØªÙ† Ø±ÙˆÛŒ ÛŒÚ© Ø®Ø· Ø¨Ù…ÙˆÙ†Ù‡ */
      min-width: 220px; /* Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ "Ø­Ø¯Ø§Ú©Ø«Ø± Û²Û°" Ùˆ "Ø­Ø¯Ø§Ú©Ø«Ø± Û³Û°" */
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" id="logo">
  <h1>Pic2PDF Bita</h1>
  <span>v1.6</span>
</header>

<div class="container">
  <!-- 1) Ø¹Ú©Ø³â€ŒÙ‡Ø§ -->
  <div class="file-row">
    <label for="fileInput">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³â€ŒÙ‡Ø§ (Ø­Ø¯Ø§Ú©Ø«Ø± Û³Û°):</label>
    <input type="file" id="fileInput" multiple accept="image/*">
  </div>
  <ul id="fileList"></ul>

  <!-- 2) PDFÙ‡Ø§ -->
  <div class="file-row">
    <label for="pdfInput">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ PDF (Ø­Ø¯Ø§Ú©Ø«Ø± Û²Û°):</label>
    <input type="file" id="pdfInput" accept="application/pdf" multiple>
  </div>

  <!-- 3) ØªØ±ØªÛŒØ¨ Ø§Ø¯ØºØ§Ù… -->
  <div class="merge-order">
    <label>ØªØ±ØªÛŒØ¨ Ø§Ø¯ØºØ§Ù…:</label>
    <label class="option"><input type="radio" name="order" value="images-first" checked> Ø§ÙˆÙ„ Ø¹Ú©Ø³â€ŒÙ‡Ø§ØŒ Ø¨Ø¹Ø¯ PDFÙ‡Ø§</label>
    <label class="option"><input type="radio" name="order" value="pdfs-first"> Ø§ÙˆÙ„ PDFÙ‡Ø§ØŒ Ø¨Ø¹Ø¯ Ø¹Ú©Ø³â€ŒÙ‡Ø§</label>
  </div>

  <!-- 4) Ù†Ø§Ù… ÙØ§ÛŒÙ„ PDF -->
  <label for="pdfName">Ù†Ø§Ù… ÙØ§ÛŒÙ„ PDF:</label>
  <input type="text" id="pdfName" placeholder="Ù…Ø«Ù„Ø§Ù‹ MyPhotos.pdf">

  <button class="download-btn" id="generateBtn">ğŸ“‚ Ø³Ø§Ø®Øª PDF Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>
</div>

<!-- ÙÙ‚Ø· pdf-lib Ú©Ø§ÙÛŒØ³Øª -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const pdfInput = document.getElementById('pdfInput');
const fileList = document.getElementById('fileList');
const generateBtn = document.getElementById('generateBtn');
const pdfNameInput = document.getElementById('pdfName');

const MAX_IMAGES = 30;
const MAX_PDFS = 20;
let images = [];

// Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³â€ŒÙ‡Ø§
fileInput.addEventListener('change', (e) => {
  const files = Array.from(e.target.files);
  if (files.length + images.length > MAX_IMAGES) {
    alert(`Ø­Ø¯Ø§Ú©Ø«Ø± ${MAX_IMAGES} Ø¹Ú©Ø³ Ù…Ø¬Ø§Ø² Ø§Ø³Øª.`);
    return;
  }
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = (evt) => { images.push(evt.target.result); renderList(); };
    reader.readAsDataURL(file);
  });
});

// Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø¹Ú©Ø³â€ŒÙ‡Ø§
function renderList() {
  fileList.innerHTML = '';
  images.forEach((img, index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      Ø¹Ú©Ø³ ${index + 1}
      <span>
        <button onclick="moveUp(${index})">â†‘</button>
        <button onclick="moveDown(${index})">â†“</button>
        <button onclick="removeImg(${index})">âŒ</button>
      </span>
    `;
    fileList.appendChild(li);
  });
}
window.moveUp = (i) => { if (i===0) return; [images[i-1], images[i]]=[images[i], images[i-1]]; renderList(); };
window.moveDown = (i) => { if (i===images.length-1) return; [images[i+1], images[i]]=[images[i], images[i+1]]; renderList(); };
window.removeImg = (i) => { images.splice(i,1); renderList(); };

// Ø³Ø§Ø®Øª Ùˆ Ø§Ø¯ØºØ§Ù… PDF
generateBtn.addEventListener('click', async () => {
  if (images.length === 0 && pdfInput.files.length === 0) {
    alert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¹Ú©Ø³ ÛŒØ§ ÛŒÚ© ÙØ§ÛŒÙ„ PDF Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
    return;
  }
  if (pdfInput.files.length > MAX_PDFS) {
    alert(`Ø­Ø¯Ø§Ú©Ø«Ø± ${MAX_PDFS} ÙØ§ÛŒÙ„ PDF Ù…Ø¬Ø§Ø² Ø§Ø³Øª.`);
    return;
  }

  const pdfName = (pdfNameInput.value.trim() || 'MyPhotos.pdf').replace(/[/\\:*?"<>|]/g,'_');
  const order = document.querySelector('input[name="order"]:checked').value;

  const mergedPdf = await PDFLib.PDFDocument.create();

  async function addImages() {
    for (let i = 0; i < images.length; i++) {
      const imgBytes = await fetch(images[i]).then(r => r.arrayBuffer());
      const isPng = images[i].startsWith('data:image/png');
      const embedded = isPng ? await mergedPdf.embedPng(imgBytes) : await mergedPdf.embedJpg(imgBytes);

      const page = mergedPdf.addPage();
      const { width, height } = page.getSize();
      const iw = embedded.width, ih = embedded.height;
      const scale = Math.min(width / iw, height / ih);
      const w = iw * scale, h = ih * scale;

      page.drawImage(embedded, { x: (width - w)/2, y: (height - h)/2, width: w, height: h });
    }
  }

  async function addPdfs() {
    for (let i = 0; i < pdfInput.files.length; i++) {
      const buf = await pdfInput.files[i].arrayBuffer();
      const ext = await PDFLib.PDFDocument.load(buf);
      const pages = await mergedPdf.copyPages(ext, ext.getPageIndices());
      pages.forEach(p => mergedPdf.addPage(p));
    }
  }

  if (order === 'images-first') {
    await addImages();
    await addPdfs();
  } else {
    await addPdfs();
    await addImages();
  }

  const bytes = await mergedPdf.save();
  const blob = new Blob([bytes], { type: 'application/pdf' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = pdfName;
  a.click();
});
</script>

</body>
</html>
